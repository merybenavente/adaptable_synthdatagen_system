# DEMO Example 1: Freediving Gear Reviews (TEMPLATER showcase)
# Use case: Generate synthetic product reviews with sentiment labels
# Showcases: Grammar-based generation, auto-schema derivation, structured output

# Job metadata
job_id: freediving_gear_reviews_demo

# Domain and task configuration
domain: text_classification
task: sentiment_classification

# Task input specification
task_input:
  description: "Generate synthetic product reviews for freediving fins with sentiment labels."
  labels:
    - positive
    - negative
  label_distribution:
    positive: 0.6
    negative: 0.4
  languages:
    - en
  review_length_tokens:
    min: 15
    max: 120
  include_slang: true
  product_category: "freediving fins"

# Number of samples to generate
num_samples: 10

# Output configuration
output_format: jsonl
output_path: "data/generated/freediving_reviews.jsonl"

# Constraints and validation schema
constraints:
  # JSON schema for output validation (auto-derives from grammar!)
  # schema: # Commented out to test auto-derivation from grammar

  # Quality constraints
  max_repetition_rate: 0.1
  semantic_coherence: true

  # Task-specific constraints
  maintain_label_distribution: true
  natural_language: true
  avoid_bias: true

validators:
  # Sample-level validators
  deduplication:
    enabled: true
    check_field: "content"

  json_schema:
    enabled: true
    threshold: 1.0

  llm_judge:
    enabled: true
    threshold: 0.6
    model: "gpt-4o-mini"

# Grammar for template-based generation - COMPLEX COMPOSITIONAL VERSION
# ðŸŽ¯ TEMPLATER generator uses this to create structured, consistent output
# This version demonstrates nested rules, compositional structures, and fine-grained control
grammar:
  start: "review_document"

  rules:
    # Top level: Full review document with all fields
    review_document:
      - template: '{"review_text": "<review_body>", "sentiment": "<sentiment_label>", "rating": <rating>, "product_details": {"size": "<size>", "blade_stiffness": "<blade_stiffness>", "color": "<color>"}, "reviewer_profile": {"experience_level": "<experience_level>", "use_case": "<use_case>", "verified_purchase": <verified_purchase>}}'
        weight: 1.0

    # Sentiment label (follows target distribution)
    sentiment_label:
      - template: "positive"
        weight: 0.6
      - template: "negative"
        weight: 0.4

    # Rating (aligned with sentiment)
    rating:
      - template: "5"
        weight: 0.3
      - template: "4"
        weight: 0.3
      - template: "3"
        weight: 0.2
      - template: "2"
        weight: 0.1
      - template: "1"
        weight: 0.1

    # Product details - Size
    size:
      - template: "S"
        weight: 0.25
      - template: "M"
        weight: 0.5
      - template: "L"
        weight: 0.25

    # Product details - Blade stiffness
    blade_stiffness:
      - template: "soft"
        weight: 0.3
      - template: "medium"
        weight: 0.4
      - template: "hard"
        weight: 0.3

    # Product details - Color
    color:
      - template: "black"
        weight: 0.3
      - template: "blue"
        weight: 0.25
      - template: "red"
        weight: 0.15
      - template: "yellow"
        weight: 0.15
      - template: "grey"
        weight: 0.15

    # Reviewer profile - Experience level
    experience_level:
      - template: "beginner"
        weight: 0.2
      - template: "intermediate"
        weight: 0.5
      - template: "advanced"
        weight: 0.3

    # Reviewer profile - Use case
    use_case:
      - template: "recreational"
        weight: 0.4
      - template: "training"
        weight: 0.3
      - template: "competition"
        weight: 0.2
      - template: "spearfishing"
        weight: 0.1

    # Reviewer profile - Verified purchase
    verified_purchase:
      - template: "true"
        weight: 0.8
      - template: "false"
        weight: 0.2

    # Main review body - compositional structure with multiple paths
    review_body:
      - template: "<opening_statement> <technical_details> <conclusion>"
        weight: 0.3
      - template: "<experience_intro> <specific_features> <recommendation>"
        weight: 0.3
      - template: "<quick_opinion> <elaboration>"
        weight: 0.2
      - template: "<comparative_statement> <justification>"
        weight: 0.2

    # Opening statements
    opening_statement:
      - llm_fill:
          prompt: "Write a 1-sentence opening for a freediving fin review that expresses overall satisfaction (positive tone). 10-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write a 1-sentence opening for a freediving fin review that expresses disappointment (negative tone). 10-20 tokens."
        weight: 0.4

    # Quick opinions (shorter, more casual)
    quick_opinion:
      - llm_fill:
          prompt: "Write a brief opinion statement about freediving fins (positive). Very casual, 8-15 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write a brief opinion statement about freediving fins (negative). Very casual, 8-15 tokens."
        weight: 0.4

    # Technical details - composed of multiple aspects
    technical_details:
      - template: "<blade_performance> <comfort_aspect>"
        weight: 0.4
      - template: "<efficiency_comment> <durability_note>"
        weight: 0.3
      - template: "<blade_performance>"
        weight: 0.3

    # Blade performance details
    blade_performance:
      - llm_fill:
          prompt: "Write 1 sentence about blade stiffness and propulsion power (positive experience). 15-25 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write 1 sentence about blade flexibility issues or weak propulsion (negative). 15-25 tokens."
        weight: 0.4

    # Comfort aspects
    comfort_aspect:
      - llm_fill:
          prompt: "Write 1 sentence about foot pocket comfort, fit, or no blisters (positive). 12-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write 1 sentence about discomfort, blisters, or sizing issues (negative). 12-20 tokens."
        weight: 0.4

    # Efficiency comments
    efficiency_comment:
      - llm_fill:
          prompt: "Write 1 sentence about energy efficiency and kick effectiveness (positive). 15-25 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write 1 sentence about tiring to use or inefficient (negative). 15-25 tokens."
        weight: 0.4

    # Durability notes
    durability_note:
      - llm_fill:
          prompt: "Write 1 sentence about build quality and durability (positive). 10-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write 1 sentence about cracking, breaking, or poor materials (negative). 10-20 tokens."
        weight: 0.4

    # Specific features discussion
    specific_features:
      - template: "<feature_highlight> <feature_highlight>"
        weight: 0.5
      - template: "<feature_highlight>"
        weight: 0.5

    feature_highlight:
      - llm_fill:
          prompt: "Mention one specific positive feature of freediving fins (depth performance, maneuverability, blade angle, etc). 12-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Mention one specific negative aspect of freediving fins (poor maneuverability, wrong blade angle, etc). 12-20 tokens."
        weight: 0.4

    # Experience introductions
    experience_intro:
      - llm_fill:
          prompt: "Write a casual intro about testing/using freediving fins (context: open water, training, depth work). 15-25 tokens."
        weight: 1.0

    # Elaboration (supporting details)
    elaboration:
      - template: "<specific_example> <impact_statement>"
        weight: 0.5
      - template: "<specific_example>"
        weight: 0.5

    specific_example:
      - llm_fill:
          prompt: "Give a specific example or scenario showing why the fins are good. 20-35 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Give a specific example or scenario showing why the fins are problematic. 20-35 tokens."
        weight: 0.4

    impact_statement:
      - llm_fill:
          prompt: "Write 1 sentence about how the fins improved your diving (positive). 12-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write 1 sentence about how the fins hindered your diving (negative). 12-20 tokens."
        weight: 0.4

    # Conclusions and recommendations
    conclusion:
      - llm_fill:
          prompt: "Write a concluding sentence with a positive recommendation. 10-20 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write a concluding sentence discouraging purchase. 10-20 tokens."
        weight: 0.4

    recommendation:
      - llm_fill:
          prompt: "Write a recommendation statement (who should buy these fins, value assessment). Positive tone. 15-25 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Write a recommendation statement (who should avoid these fins, value assessment). Negative tone. 15-25 tokens."
        weight: 0.4

    # Comparative statements
    comparative_statement:
      - llm_fill:
          prompt: "Compare these fins to other freediving fins you've used (positive comparison). 15-30 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Compare these fins to other freediving fins you've used (negative comparison). 15-30 tokens."
        weight: 0.4

    justification:
      - llm_fill:
          prompt: "Justify your comparison with specific reasons (positive). 15-25 tokens."
        weight: 0.6
      - llm_fill:
          prompt: "Justify your comparison with specific reasons (negative). 15-25 tokens."
        weight: 0.4
